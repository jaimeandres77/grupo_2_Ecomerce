<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head/meta') %>
    <title>Editar <%= game.name %></title>
    <%- include('../partials/head/css') %>
    <link rel="stylesheet" href="/css/createProduct.css">
</head>
<body>
    <%- include('../partials/header') %>
    <% const plataformas = []; %>
    <% const generos = []; %>
    <% game.platforms.forEach(platform => { %>
        <% plataformas.push(platform.id) %>
    <% }) %>
    <% game.genres.forEach(genre => { %>
        <% generos.push(genre.id) %>
    <% }) %>
    <main>
        <div class="container form__game">
            <form action="/product/edit/<%= game.id %>?_method=PATCH" method="POST" enctype="multipart/form-data">
                <h1 class="">Editar <%= game.name %></h1>
                <% if (locals.errors) { %>
                    <div class="alert alert-danger">
                        <ul>
                        <% Object.values(errors).forEach((error,index) => { %>
                            <li><%= index + 1 %>. <%= error.msg %></li>
                        <% }) %>
                        </ul>
                    </div>
                <% } %>
                <input type="hidden" name="sas" value="<%= plataformas %>/<%= generos %>/<%= game.image %>">
                <div class="campo-50">
                    <label for="name">Nombre:</label>
                    <% if (locals.oldData && oldData.name) { %>
                        <input type="text" name="name" id="name" placeholder="Nombre" value="<%= oldData.name %>">
                    <% } else { %>
                        <input type="text" name="name" id="name" placeholder="Nombre" value="<%= game.name %>">
                    <% } %>
                </div>
                <div class="campo-50">
                    <label for="sku">SKU:</label>
                    <% if (locals.oldData && oldData.sku) { %>
                        <input type="text" name="sku" id="sku" placeholder="SKU" value="<%= oldData.sku %>">
                    <% } else { %>
                        <input type="text" name="sku" id="sku" placeholder="SKU" value="<%= game.sku %>">
                    <% } %>
                </div>
                <div class="campo-50">
                    <label for="price">Precio:</label>
                    <% if (locals.oldData && oldData.price) { %>
                        <input type="number" name="price" id="price" placeholder="50000" value="<%= oldData.price %>">
                    <% } else { %>
                        <input type="number" name="price" id="price" placeholder="50000" value="<%= game.price %>">
                    <% } %>
                </div>
                <div class="campo-50">
                    <label for="discount">Descuento:</label>
                    <% if (locals.oldData && oldData.discount) { %>
                        <input type="number" name="discount" id="discount" placeholder="0 - 100" value="<%= oldData.discount %>">
                    <% } else { %>
                        <input type="number" name="discount" id="discount" placeholder="0 - 100" value="<%= game.discount %>">
                    <% } %>
                </div>
                <div class="campo-50">
                    <label for="stock">Stock:</label>
                    <% if (locals.oldData && oldData.stock) { %>
                        <input type="number" name="stock" id="stock" placeholder="0" value="<%= oldData.stock %>">
                    <% } else { %>
                        <input type="number" name="stock" id="stock" placeholder="0" value="<%= game.stock %>">
                    <% } %>
                </div>
                <div class="campo-50">
                    <label for="image">Imagen:</label>
                    <input type="file" name="image" id="image">
                </div>
                <div class="campo">
                    <label for="description" class="label-100">Descripci√≥n</label>
                    <% if (locals.oldData && oldData.description) { %>
                        <textarea name="description" id="description" cols="30" rows="5"><%= oldData.description %></textarea>
                    <% } else { %>
                        <textarea name="description" id="description" cols="30" rows="5"><%= game.description %></textarea>
                    <% } %>
                </div>
                <div class="campo">
                    <p>Plataformas:</p>
                    <% if (locals.platforms && platforms.length > 0) { %>
                        <% platforms.forEach(platform => { %>
                            <label for="<%= platform.name %>">
                                <% if(locals.oldData && oldData.platform){ %>
                                    <input type="checkbox" name="platform" id="<%= platform.name %>" value="<%= platform.id %>" <%= oldData.platform.includes(platform.id.toString()) ? 'checked' : '' %> /><%= platform.name %>
                                <% } else { %>
                                    <input type="checkbox" name="platform" id="<%= platform.name %>" value="<%= platform.id %>" <%= plataformas.includes(platform.id) ? 'checked' : '' %> /><%= platform.name %>
                                <% } %>
                            </label>
                        <% }) %>
                    <% } else { %>
                        No hay plataformas registradas.
                    <% } %>
                </div>
                <div class="campo">
                    <p>Generos:</p>
                    <% if (locals.genres && genres.length > 0) { %>
                        <% genres.forEach(genre => { %>
                            <label for="<%= genre.name %>">
                                <% if(locals.oldData && oldData.genre){ %>
                                    <input type="checkbox" name="genre" id="<%= genre.name %>" value="<%= genre.id %>" <%= oldData.genre.includes(genre.id.toString()) ? 'checked' : '' %> /><%= genre.name %>
                                <% } else { %>
                                    <input type="checkbox" name="genre" id="<%= genre.name %>" value="<%= genre.id %>" <%= generos.includes(genre.id) ? 'checked' : '' %>><%= genre.name %>
                                <% } %>
                            </label>
                        <% }) %>
                    <% } else { %>
                        No hay generos registrados.
                    <% } %>
                </div>
                <div class="button">
                    <button type="submit" class="btn btn-primary">Registrar Juego</button>
                </div>
            </form>
        </div>
    </main>


    <%- include('./../partials/footer') %>
</body>
</html>